# 🌐 国网风险预警平台 - 使用指南

## 📋 目录

1. [平台访问](#平台访问)
2. [功能概览](#功能概览)
3. [快速开始](#快速开始)
4. [核心功能](#核心功能)
5. [常见问题](#常见问题)

---

## 🌍 平台访问

### 生产环境
**URL**: https://risk-alert-platform.pages.dev

**特性**:
- ✅ 全球 CDN 加速
- ✅ 自动 HTTPS
- ✅ 24/7 在线
- ✅ 完全免费

### 本地开发
```bash
# 克隆项目
git clone https://github.com/shanshanyin5-png/risk-alert-platform.git
cd risk-alert-platform

# 安装依赖
npm install

# 启动本地服务（需要先配置 .dev.vars）
npm run dev:sandbox
```

---

## 🎯 功能概览

### 1. 监控大屏 📊
实时展示风险统计数据：
- 总风险数、高风险数、中风险数、低风险数
- 公司风险分布
- 风险趋势图表

### 2. 一键更新 🔄
**核心功能**：自动爬取所有数据源并分析风险

**使用方法**：
1. 点击监控大屏右上角的 **"一键更新"** 按钮
2. 系统自动爬取 31 个数据源
3. 使用 AI 智能分析新闻风险
4. 自动分类并录入数据库
5. 完成后显示更新摘要

**时间**：约 2-5 分钟（取决于网络和数据源）

**要求**：需要配置 OpenAI API Key（参见 [OPENAI_CONFIG.md](./OPENAI_CONFIG.md)）

### 3. 风险列表 📋
查看所有风险记录：
- 支持按公司、风险等级、关键词筛选
- 支持时间范围筛选
- 分页显示
- 点击查看详情

### 4. 数据源管理 🌐
管理爬取网站源：
- 查看所有 31 个数据源配置
- 添加/编辑/删除数据源
- 查看爬取状态和成功率
- 测试数据源连接

**已配置的数据源分类**：
- **公司官网** (6个)：CPFL、CGE、NGCP、国家电网等
- **新闻媒体** (15个)：新华网、人民网、CNN、BBC、路透社等
- **政府机构** (3个)：国家能源局、商务部等
- **研究机构** (4个)：中国能源研究会、国际能源署等
- **社交媒体** (1个)：LinkedIn
- **其他** (2个)：一带一路网、全球能源互联网

### 5. 风险等级调整 ⚙️
管理企业风险等级：
- 查看所有企业及其当前风险等级
- 单个或批量调整风险等级
- 记录调整历史
- 查看调整原因和操作人

### 6. 数据录入 ✍️
人工录入风险信息：
- 填写公司名称、风险标题、风险事项
- 选择风险等级和风险时间
- 填写信息来源和风险原因
- 查看最近录入记录

### 7. 数据导出 📤
导出 Excel 文件：
- **风险信息导出**：导出所有风险记录
- **数据源导出**：导出数据源配置
- **企业列表导出**：导出企业信息
- **调整历史导出**：导出风险等级调整记录

---

## 🚀 快速开始

### 第一步：配置 OpenAI API Key

⚠️ **必须完成此步骤才能使用一键更新功能**

请参考 [OPENAI_CONFIG.md](./OPENAI_CONFIG.md) 完成配置。

### 第二步：访问平台

打开 https://risk-alert-platform.pages.dev

### 第三步：一键更新

1. 点击 **"一键更新"** 按钮
2. 确认弹窗
3. 等待 2-5 分钟
4. 查看更新结果

### 第四步：查看数据

1. 查看监控大屏统计数据
2. 进入风险列表查看详情
3. 使用筛选功能查找特定风险

---

## 🔍 核心功能详解

### 一键更新工作流程

```mermaid
graph LR
    A[点击一键更新] --> B[获取数据源列表]
    B --> C[并发爬取网站]
    C --> D[提取新闻内容]
    D --> E[GPT-4 风险分析]
    E --> F[存入数据库]
    F --> G[显示更新结果]
```

**技术细节**：
1. **爬取阶段**：
   - 使用 `fetch` 获取网页 HTML
   - 使用 `cheerio` 解析 DOM 结构
   - 根据 XPath 规则提取新闻

2. **分析阶段**：
   - 使用 OpenAI GPT-4 模型
   - 智能识别与国网及其子公司相关的新闻
   - 自动评估风险等级（高/中/低）
   - 生成风险分析报告

3. **存储阶段**：
   - 写入 Cloudflare D1 数据库
   - 自动去重（相同标题不重复录入）
   - 更新数据源的爬取统计

### AI 风险分析提示词

系统会向 GPT-4 发送以下提示：

```
你是一个专业的风险分析师，专门分析国家电网及其海外子公司的新闻。

国家电网的主要海外子公司包括：
- 巴西 CPFL 公司
- 巴西 SGP 公司
- 智利 CGE 公司
- 菲律宾 NGCP 公司
- 巴基斯坦 PMLTC 公司
- ... (其他子公司)

请分析这条新闻是否与国家电网或其子公司相关，并评估风险等级。

新闻标题：{title}
新闻内容：{content}
发布时间：{time}

请以 JSON 格式返回分析结果：
{
  "isRelevant": true/false,
  "companyName": "相关公司名称",
  "riskLevel": "高风险/中风险/低风险",
  "riskItem": "简短的风险事项描述",
  "analysis": "详细的风险分析"
}
```

### 风险等级判定标准

- **高风险** 🔴：
  - 安全事故、人员伤亡
  - 政治风险、政策变化
  - 重大经济损失
  - 法律诉讼、合规问题

- **中风险** 🟠：
  - 运营问题、技术故障
  - 市场波动、竞争压力
  - 劳资纠纷、罢工
  - 环境问题、社会舆情

- **低风险** 🟢：
  - 日常运营新闻
  - 正面报道、荣誉奖项
  - 业务拓展、合作签约
  - 技术创新、项目进展

---

## 📊 数据统计

### 当前数据规模
- **企业数量**：11 家
- **风险记录**：7 条（初始数据）
- **数据源**：31 个
- **调整历史**：3 条

### 一键更新后的预期
- **新增风险**：50-200 条/次
- **更新时间**：2-5 分钟
- **覆盖范围**：全球主要媒体和官方网站

---

## ❓ 常见问题

### Q1：一键更新点击后没有反应？
**A**：请检查：
1. 是否已配置 OpenAI API Key
2. 网络连接是否正常
3. 浏览器控制台是否有错误信息

### Q2：爬取速度太慢
**A**：正常情况 2-5 分钟，影响因素：
- 数据源网站的响应速度
- OpenAI API 的处理速度
- 网络环境

### Q3：某些数据源爬取失败
**A**：可能原因：
- 网站无法访问（被墙、服务器故障）
- XPath 规则不匹配（网站改版）
- 超时（网站响应慢）

**解决方法**：
1. 在数据源管理中查看失败的数据源
2. 点击 "测试连接" 查看具体错误
3. 编辑 XPath 规则或禁用该数据源

### Q4：风险等级不准确
**A**：AI 分析可能存在偏差，可以：
1. 在风险列表中点击详情查看
2. 进入编辑模式手动调整风险等级
3. 在风险等级调整页面统一调整公司整体等级

### Q5：如何添加新的数据源？
**A**：
1. 进入 "数据源管理" 标签
2. 点击 "添加数据源"
3. 填写网站信息和 XPath 规则
4. 测试连接确保配置正确
5. 保存后即可在一键更新中包含

### Q6：导出的 Excel 文件打开乱码
**A**：使用 Microsoft Excel 或 WPS 打开，确保选择 UTF-8 编码

### Q7：可以定时自动更新吗？
**A**：当前版本需要手动点击，后续版本可以添加：
- Cloudflare Workers Cron（定时触发）
- 每天自动更新 1-2 次
- 发送邮件通知

---

## 🔧 技术架构

### 前端技术
- **Vue 3**：渐进式框架
- **Tailwind CSS**：原子化 CSS
- **Font Awesome**：图标库
- **Axios**：HTTP 客户端
- **XLSX**：Excel 导入导出

### 后端技术
- **Hono**：轻量级 Web 框架
- **TypeScript**：类型安全
- **Cloudflare Pages**：边缘计算平台
- **Cloudflare D1**：SQLite 数据库
- **Cloudflare Workers**：无服务器函数

### AI & 爬虫
- **OpenAI GPT-4**：风险分析
- **Cheerio**：HTML 解析
- **Fetch API**：网页抓取

---

## 📚 相关文档

- [部署指南](./CLOUDFLARE_DEPLOY_GUIDE.md)
- [OpenAI 配置](./OPENAI_CONFIG.md)
- [功能测试报告](./FUNCTION_TEST_REPORT.md)
- [部署成功报告](./DEPLOYMENT_SUCCESS.md)
- [GitHub 仓库](https://github.com/shanshanyin5-png/risk-alert-platform)

---

## 🆘 获取帮助

如果遇到问题：
1. 查看浏览器控制台错误信息
2. 查看 [常见问题](#常见问题) 部分
3. 提交 GitHub Issue
4. 联系项目维护者

---

## 📝 更新日志

### v2.0.0 - 2026-01-04
- ✅ 添加爬虫功能
- ✅ 添加一键更新按钮
- ✅ 集成 OpenAI GPT-4
- ✅ 优化前端交互

### v1.0.0 - 2026-01-04
- ✅ 基础功能完成
- ✅ 部署到 Cloudflare Pages
- ✅ 数据库迁移完成

---

## 📄 许可证

MIT License

---

**祝使用愉快！** 🎉
